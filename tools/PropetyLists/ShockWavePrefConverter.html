<html>
	<head>
		<meta charset="UTF-8"/>
		<title>Shockwave Preference Converter</title>
		<style type="text/css">
			textarea {
				resize: none;
			}
		</style>
	</head>
	<body>
		<strong>INPUT:</strong><br/>
		<textarea rows="15" cols="106" id="in">["test","test2",1,#foo:"bar",#rodents:["mouse","rat"]]</textarea>
		<br/><strong>CONVERTED OUTPUT:</strong><br/>
		<textarea rows="15" cols="106" id="out"></textarea>
	<script>
		var input = document.getElementById("in");
		var output = document.getElementById("out");
		
		/*
		function readString(txt) {
			return txt.substr(1,txt.length-2);
		}
		
		function readNumber(txt) {
			return Number(txt);
		}
		
		function readAttribute(txt) {
			var out = {"name":"","data":0};
			for (var i=1; i < txt.length; i++) {
				var curr = txt.charAt(i);
				if (curr == ":") {
					out.data = txt.substr(i + 1);
					break;
				}
				out.name += curr;
			}
			return out;
		}
		
		function readPointer(txt) {
			return txt;
		}
		
		function getChildren(txt){
			out = [];
			console.log(txt);
			var end = txt.length - 2;
			var temp = "";
			var inString = false;
			var indentLevel = 0;
			for (var i=0; i < txt.length; i++) {
				var curr = txt.charAt(i);
				if (isWhiteSpace(curr) && !inString) {
					continue;
				}
				if (curr == "\"") {
					!inString;
				}
				if (curr == "[") indentLevel++;
				if (curr == "]") indentLevel--;
				if (curr == "," && !inString && indentLevel <= 0) {
					out.push(temp);
					temp = "";
					inString = false;
					continue;
				}
				if (i == end) {
					if (!isWhiteSpace(curr)) temp += curr;
					out.push(temp);
					console.log("$[ " + out.join(" , ") + " ]$");
					break;
				}
				temp += curr;
			}
			return out;
		}
		
		function isWhiteSpace(txtChar) {
			var out = false;
			switch (txtChar) {
				case " " :
					out = true;
					break;
				case "\t" :
					out = true;
					break;
				case "\n" :
					out = true;
					break;
				case "\r" :
					out = true;
					break;
				default :
					break;
			}
			return out;
		}
		
		function isAttribute(txt) {
			var out = false;
			for (var i=0; i< txt.length; i++) {
				var curr = txt.charAt(i);
				if (curr == ":") {
					out = true;
					break;
				}
				if (isWhiteSpace(curr)) break;
				if (curr == ",") break;
				if (curr == "]") break;
			}
			return out;
		}
		
		function getType(txt) {
			var out = "???";
			var lBracketTotal = 0;
			var rBracketTotal = 0;
			var indentLevel = 0;
			var foundQuotes = false;
			var foundIDChar = false;
			var foundAttr = false;
			var foundAttr2 = false;
			for (var i=0; i< txt.length; i++) {
				var curr = txt.charAt(i);
				switch (curr) {
					case "[" :
						lBracketTotal++;
						indentLevel++;
						break;
					case "]" :
						rBracketTotal++;
						indentLevel--;
						break;
					case "#" : 
						foundIDChar = true;
						if (!foundAttr) {
							foundAttr = isAttribute(txt.substr(i));
							if (i == 0) foundAttr2 = true;
						}
						if(isAttribute(txt.substr(i)) && indentLevel == 1) {
							out = "obj";
						}
						break;
					case "\"" :
						foundQuotes = true;
						break;
					default :
						break;
				}
			}
			if (lBracketTotal == 0 && rBracketTotal == 0) {
				if (!foundIDChar) {
					out = "number";
					if (foundQuotes) out = "string"
				} else if (foundIDChar){
					if (!foundAttr) {
						out = "pointer";
					} else {
						out = "attribute";
					}
				}
			} else {
				if (out != "obj") {
					out = "array";
					if (foundAttr) out = "attribute";
				} else {
					if (foundAttr2) out = "attribute"; //catch nested objects
				}
			}
			if (lBracketTotal != rBracketTotal) console.log("WARNING : UNEVEN BRACKETS DETECTED!");
			return out;
		}
		
		function convertSegment(txt) {
			var out = {};
			var hasChildren = false;
			var children = [];
			var objType = getType(txt);
			if (objType == "obj" || objType == "array") hasChildren = true;
			if (hasChildren) {
				children = getChildren(txt.substr(1,txt.length-1));
				if (objType == "array") {
					out = [];
					for (var i=0; i< children.length; i++) {
						var curr = getType(children[i]);
						var curr2 = children[i];
						switch (curr) {
							case "pointer" : 
								out.push(readPointer(curr2));
								break;
							case "attribute" :
								console.log("ATTRIBUTE DETECTED IN ARRAY, SKIPPING");
								break; //this should never occur in an array
							case "number" :
								out.push(readNumber(curr2));
								break;
							case "string" :
								out.push(readString(curr2));
								break;
							case "obj" :
								out.push(convertSegment(curr2));
								break;
							case "array" :
								out.push(convertSegment(curr2));
								break;
							default:
								break;
						}
					}
				} else {
					for (var i=0; i< children.length; i++) {
						var curr = getType(children[i]);
						var curr2 = children[i];
						if (curr != "attribute") {
							console.log("CANNOT CONVERT " + curr2 + " TO AN OBJECT ATTRIBUTE, SKIPPING!");
						} else {
							var curr3 = readAttribute(curr2);
							var attrName = curr3.name;
							var attrData = convertSegment(curr3.data);
							out[attrName] = attrData;
						}
					}
				}
			} else {
				switch(objType) {
					case "pointer" : 
						out = readPointer(txt);
						break;
					case "attribute" :
						console.log("ATTRIBUTE DETECTED IN SIMPLE DATA...SKIPPING");
						break; //this should never occur in simple datatypes, either
					case "number" :
						out = readNumber(txt);
						break;
					case "string" :
						out = readString(txt);
						break;
				}
			}
			return out;
		}
		
		function convertToJSON() {
			var out = {};
			out = convertSegment(input.value);
			output.value = JSON.stringify(out);
		} */
	</script>
	<script type="text/javascript" src="shockPref.js"></script>
		<br/><button onclick="convertToJSON()">Convert!!</button>
	</body>
</html>